import{a as v,ar as c,S as m,as as k,o as f,al as V,d as l,w as o,j as w,b as d,e as i,h as p,i as g,W as S,am as q,f as T,ag as h,at as B,aj as _,ai as D,au as F,bs as N,ah as $}from"./index.b84716e4.js";import{V as j,a as A}from"./VTextarea.82893996.js";import{V as z}from"./VTable.19ad7d7b.js";import{V as E}from"./VForm.fa53c73b.js";import{V as b}from"./VTextField.7c6d58b4.js";import{V as I}from"./VSelect.5139a604.js";import"./VOverlay.cbc7e026.js";import"./VList.77ebb99b.js";import"./VDivider.c9724616.js";const L={id:"admin-products"},M=d("h1",{class:"text-center"},"\u5546\u54C1\u7BA1\u7406",-1),P=d("thead",null,[d("tr",null,[d("th",null,"\u5716\u7247"),d("th",null,"\u540D\u7A31"),d("th",null,"\u50F9\u683C"),d("th",null,"\u7BA1\u7406")])],-1),R={class:"text-center"},le={__name:"ProductsView",setup(W){const x=["\u6A21\u578B","\u904A\u6232\u738B\u5361","\u516C\u4ED4","\u666F\u54C1","\u9ECF\u571F\u4EBA","\u5176\u4ED6"],u={required(t){return!!t||"\u6B04\u4F4D\u5FC5\u586B"},price(t){return t>=0||"\u50F9\u683C\u932F\u8AA4"}},r=v([]),e=v({_id:"",name:"",price:0,sales:0,description:"",image:void 0,sell:!1,category:"",valid:!1,loading:!1,dialog:!1,idx:-1}),y=t=>{t===-1?(e._id="",e.name="",e.price=0,e.sales=0,e.description="",e.image=void 0,e.sell=!1,e.category="",e.valid=!1,e.loading=!1,e.idx=-1):(e._id=r[t]._id,e.name=r[t].name,e.price=r[t].price,e.sales=r[t].sales,e.description=r[t].description,e.image=void 0,e.sell=r[t].sell,e.category=r[t].category,e.valid=!1,e.loading=!1,e.idx=t),e.dialog=!0},C=async()=>{var s,n;if(!e.valid)return;e.loading=!0;const t=new FormData;t.append("name",e.name),t.append("price",e.price),t.append("sales",e.sales),t.append("description",e.description),t.append("image",e.image),t.append("sell",e.sell),t.append("category",e.category);try{if(e._id.length===0){const{data:a}=await c.post("/products",t);r.push(a.result),m.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:a}=await c.patch("/products/"+e._id,t);r[e.idx]=a.result,m.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(a){m.fire({icon:"error",title:"\u5931\u6557",text:((n=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:n.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1};return(async()=>{var t,s;try{const{data:n}=await c.get("/products/all");r.push(...n.result)}catch(n){m.fire({icon:"error",title:"\u5931\u6557",text:((s=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:s.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(t,s)=>{const n=k("v-image-input");return f(),V("div",L,[M,l(w,null,{default:o(()=>[l(i,{cols:"12"},{default:o(()=>[l(p,{color:"success",onClick:s[0]||(s[0]=a=>y(-1))},{default:o(()=>[g("\u65B0\u589E\u5546\u54C1")]),_:1})]),_:1}),l(i,{cols:"12"},{default:o(()=>[l(z,null,{default:o(()=>[P,d("tbody",null,[(f(!0),V(S,null,q(r,(a,U)=>(f(),V("tr",{key:a._id},[d("td",null,[l($,{src:a.image,"aspect-ratio":1,width:200},null,8,["src"])]),d("td",null,_(a.name),1),d("td",null,_(a.price),1),d("td",null,[l(p,{color:"primary",icon:"mdi-pencil",variant:"text",onClick:G=>y(U)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1}),l(j,{modelValue:e.dialog,"onUpdate:modelValue":s[9]||(s[9]=a=>e.dialog=a),persistent:"persistent"},{default:o(()=>[l(E,{modelValue:e.valid,"onUpdate:modelValue":s[8]||(s[8]=a=>e.valid=a),onSubmit:T(C,["prevent"])},{default:o(()=>[l(h,null,{default:o(()=>[l(B,null,{default:o(()=>[d("h1",R,_(e._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1)]),_:1}),l(D,null,{default:o(()=>[l(w,null,{default:o(()=>[l(i,{cols:"3"}),l(i,{cols:"6"},{default:o(()=>[l(b,{modelValue:e.name,"onUpdate:modelValue":s[1]||(s[1]=a=>e.name=a),type:"text",label:"\u540D\u7A31",rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"3"}),l(i,{cols:"3"}),l(i,{cols:"3"},{default:o(()=>[l(b,{modelValue:e.price,"onUpdate:modelValue":s[2]||(s[2]=a=>e.price=a),type:"number",label:"\u50F9\u683C",rules:[u.required,u.price]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"3"},{default:o(()=>[l(b,{modelValue:e.sales,"onUpdate:modelValue":s[3]||(s[3]=a=>e.sales=a),type:"number",label:"\u92B7\u91CF",rules:[u.required,u.sales]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"3"}),l(i,{cols:"3"}),l(i,{cols:"6"},{default:o(()=>[l(A,{modelValue:e.description,"onUpdate:modelValue":s[4]||(s[4]=a=>e.description=a),rows:"1","auto-grow":"auto-grow",label:"\u8AAA\u660E",rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"3"}),l(i,{cols:"3"}),l(i,{cols:"6"},{default:o(()=>[l(I,{modelValue:e.category,"onUpdate:modelValue":s[5]||(s[5]=a=>e.category=a),items:x,label:"\u5206\u985E",rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"12"},{default:o(()=>[l(n,{modelValue:e.image,"onUpdate:modelValue":s[6]||(s[6]=a=>e.image=a),class:"mx-auto",removable:"removable","max-file-size":1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,null,{default:o(()=>[l(N),l(p,{disabled:e.loading,color:"red",onClick:s[7]||(s[7]=a=>e.dialog=!1)},{default:o(()=>[g("\u53D6\u6D88")]),_:1},8,["disabled"]),l(p,{disabled:e.loading,color:"green",type:"submit"},{default:o(()=>[g("\u9001\u51FA")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"])])}}};export{le as default};
