import{a as v,ar as c,S as u,as as h,o as p,al as f,d as a,w as o,e as x,b as i,f as d,i as m,j as g,X as y,am as k,h as S,k as T,at as U,aj as b,ai as B,au as D,bs as F,ah as N}from"./index.83dc9114.js";import{V as q,a as $}from"./VTextarea.600ab87d.js";import{V as j}from"./VTable.4cb6c05f.js";import{V as A}from"./VForm.b69f8154.js";import{V as E}from"./VTextField.d8c0e7eb.js";import"./VOverlay.9239e89e.js";const z={id:"admin-events"},I=i("h1",{class:"text-center"},"\u6700\u65B0\u6D3B\u52D5",-1),L=i("thead",null,[i("tr",null,[i("th",null,"\u5716\u7247"),i("th",null,"\u540D\u7A31"),i("th",null,"\u7BA1\u7406")])],-1),M={class:"text-center"},Q={__name:"NewEvent",setup(R){const V={required(s){return!!s||"\u6B04\u4F4D\u5FC5\u586B"},price(s){return s>=0||"\u50F9\u683C\u932F\u8AA4"}},r=v([]),e=v({_id:"",name:"",description:"",image:void 0,valid:!1,loading:!1,dialog:!1,idx:-1}),_=s=>{s===-1?(e._id="",e.name="",e.description="",e.image=void 0,e.valid=!1,e.loading=!1,e.idx=-1):(e._id=r[s]._id,e.name=r[s].name,e.description=r[s].description,e.image=void 0,e.valid=!1,e.loading=!1,e.idx=s),e.dialog=!0},w=async()=>{var t,n;if(!e.valid)return;e.loading=!0;const s=new FormData;s.append("name",e.name),s.append("description",e.description),s.append("image",e.image);try{if(e._id.length===0){const{data:l}=await c.post("/events",s);r.push(l.result),u.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:l}=await c.patch("/events/"+e._id,s);r[e.idx]=l.result,u.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(l){u.fire({icon:"error",title:"\u5931\u6557",text:((n=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:n.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1};return(async()=>{var s,t;try{const{data:n}=await c.get("/events/all");r.push(...n.result)}catch(n){u.fire({icon:"error",title:"\u5931\u6557",text:((t=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:t.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(s,t)=>{const n=h("v-image-input");return p(),f("div",z,[I,a(x,null,{default:o(()=>[a(d,{cols:"12"},{default:o(()=>[a(m,{color:"success",onClick:t[0]||(t[0]=l=>_(-1))},{default:o(()=>[g("\u65B0\u589E\u6D3B\u52D5")]),_:1})]),_:1}),a(d,{cols:"12"},{default:o(()=>[a(j,null,{default:o(()=>[L,i("tbody",null,[(p(!0),f(y,null,k(r,(l,C)=>(p(),f("tr",{key:l._id},[i("td",null,[a(N,{src:l.image,"aspect-ratio":1,width:100},null,8,["src"])]),i("td",null,b(l.name),1),i("td",null,[a(m,{color:"primary",icon:"mdi-pencil",variant:"text",onClick:X=>_(C)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1}),a(q,{modelValue:e.dialog,"onUpdate:modelValue":t[6]||(t[6]=l=>e.dialog=l),persistent:"persistent"},{default:o(()=>[a(A,{modelValue:e.valid,"onUpdate:modelValue":t[5]||(t[5]=l=>e.valid=l),onSubmit:S(w,["prevent"])},{default:o(()=>[a(T,null,{default:o(()=>[a(U,null,{default:o(()=>[i("h1",M,b(e._id.length>0?"\u7DE8\u8F2F\u6D3B\u52D5":"\u65B0\u589E\u6D3B\u52D5"),1)]),_:1}),a(B,null,{default:o(()=>[a(x,null,{default:o(()=>[a(d,{cols:"4"}),a(d,{cols:"4"},{default:o(()=>[a(E,{modelValue:e.name,"onUpdate:modelValue":t[1]||(t[1]=l=>e.name=l),type:"text",label:"\u540D\u7A31",rules:[V.required]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"4"}),a(d,{cols:"4"}),a(d,{cols:"4"},{default:o(()=>[a($,{modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=l=>e.description=l),rows:"3","auto-grow":"auto-grow",label:"\u8AAA\u660E",rules:[V.required]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"4"}),a(d,{cols:"12"},{default:o(()=>[a(n,{modelValue:e.image,"onUpdate:modelValue":t[3]||(t[3]=l=>e.image=l),class:"mx-auto",removable:"removable","max-file-size":1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(D,null,{default:o(()=>[a(F),a(m,{disabled:e.loading,color:"red",onClick:t[4]||(t[4]=l=>e.dialog=!1)},{default:o(()=>[g("\u53D6\u6D88")]),_:1},8,["disabled"]),a(m,{disabled:e.loading,color:"green",type:"submit"},{default:o(()=>[g("\u9001\u51FA")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"])])}}};export{Q as default};
