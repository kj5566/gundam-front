import{r as S,a as v,ar as f,S as p,as as q,o as g,al as V,d as l,w as o,e as w,b as d,f as i,i as c,j as m,X as T,am as h,h as B,k as D,at as F,aj as _,ai as N,au as $,bs as j,ah as A}from"./index.e9358893.js";import{V as z,a as E}from"./VTextarea.b901f326.js";import{V as I}from"./VTable.fdfd14fd.js";import{V as L}from"./VForm.dfef1ccc.js";import{V as b}from"./VTextField.4c0f995a.js";import{V as M}from"./VSelect.20a3a9c6.js";import"./VOverlay.f4e49acc.js";import"./VList.04498418.js";import"./VDivider.251e4419.js";const R={id:"admin-biddings"},X=d("h1",{class:"text-center"},"\u7AF6\u6A19\u7BA1\u7406",-1),G=d("thead",null,[d("tr",null,[d("th",null,"\u5716\u7247"),d("th",null,"\u540D\u7A31"),d("th",null,"\u6642\u9593"),d("th",null,"\u7BA1\u7406")])],-1),H={class:"text-center"},te={__name:"BiddingView",setup(J){const x=S(null),C=["\u6A21\u578B","\u904A\u6232\u738B\u5361","\u516C\u4ED4","\u666F\u54C1","\u5176\u4ED6"],u={required(t){return!!t||"\u6B04\u4F4D\u5FC5\u586B"},price(t){return t>=0||"\u50F9\u683C\u932F\u8AA4"},time(t){return t>=0||"\u6642\u9593\u932F\u8AA4"}},n=v([]),e=v({_id:"",name:"",price:0,description:"",image:void 0,time:0,sell:!1,category:"",valid:!1,loading:!1,dialog:!1,idx:-1}),y=t=>{t===-1?(e._id="",e.name="",e.price=0,e.time=0,e.description="",e.image=void 0,e.sell=!1,e.category="",e.valid=!1,e.loading=!1,e.idx=-1):(e._id=n[t]._id,e.name=n[t].name,e.price=n[t].price,e.time=n[t].time,e.description=n[t].description,e.image=void 0,e.sell=n[t].sell,e.category=n[t].category,e.valid=!1,e.loading=!1,e.idx=t),e.dialog=!0},k=async()=>{var s,r;if(!e.valid)return;e.loading=!0;const t=new FormData;t.append("name",e.name),t.append("price",e.price),t.append("description",e.description),t.append("image",e.image),t.append("sell",e.sell),t.append("category",e.category);try{if(e._id.length===0){const{data:a}=await f.post("/biddings",t);n.push(a.result),p.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:a}=await f.patch("/biddings/"+e._id,t);n[e.idx]=a.result,p.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(a){p.fire({icon:"error",title:"\u5931\u6557",text:((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1};return(async()=>{var t,s;try{const{data:r}=await f.get("/biddings/all");n.push(...r.result)}catch(r){p.fire({icon:"error",title:"\u5931\u6557",text:((s=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:s.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(t,s)=>{const r=q("v-image-input");return g(),V("div",R,[X,l(w,null,{default:o(()=>[l(i,{cols:"12"},{default:o(()=>[l(c,{color:"success",onClick:s[0]||(s[0]=a=>y(-1))},{default:o(()=>[m("\u65B0\u589E\u7AF6\u6A19\u5546\u54C1")]),_:1})]),_:1}),l(i,{cols:"12"},{default:o(()=>[l(I,null,{default:o(()=>[G,d("tbody",null,[(g(!0),V(T,null,h(n,(a,U)=>(g(),V("tr",{key:a._id},[d("td",null,[l(A,{src:a.image,"aspect-ratio":1,width:200},null,8,["src"])]),d("td",null,_(a.name),1),d("td",null,_(a.time),1),d("td",null,[l(c,{color:"primary",icon:"mdi-pencil",variant:"text",onClick:K=>y(U)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1}),l(z,{modelValue:e.dialog,"onUpdate:modelValue":s[9]||(s[9]=a=>e.dialog=a),persistent:"persistent"},{default:o(()=>[l(L,{modelValue:e.valid,"onUpdate:modelValue":s[8]||(s[8]=a=>e.valid=a),onSubmit:B(k,["prevent"])},{default:o(()=>[l(D,{class:"card"},{default:o(()=>[l(F,null,{default:o(()=>[d("h1",H,_(e._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u7AF6\u6A19\u5546\u54C1"),1)]),_:1}),l(N,null,{default:o(()=>[l(w,null,{default:o(()=>[l(i,{cols:"2"}),l(i,{cols:"8"},{default:o(()=>[l(b,{ref_key:"input",ref:x,modelValue:e.name,"onUpdate:modelValue":s[1]||(s[1]=a=>e.name=a),type:"text",label:"\u540D\u7A31",rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"2"}),l(i,{cols:"2"}),l(i,{cols:"8"},{default:o(()=>[l(b,{modelValue:e.price,"onUpdate:modelValue":s[2]||(s[2]=a=>e.price=a),type:"number",label:"\u8D77\u6A19\u50F9\u683C",rules:[u.required,u.price]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"2"}),l(i,{cols:"2"}),l(i,{cols:"8"},{default:o(()=>[l(b,{modelValue:e.time,"onUpdate:modelValue":s[3]||(s[3]=a=>e.time=a),type:"number",label:"\u6642\u9593",rules:[u.required,u.time]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"2"}),m(),l(i,{cols:"2"}),l(i,{cols:"8"},{default:o(()=>[l(E,{modelValue:e.description,"onUpdate:modelValue":s[4]||(s[4]=a=>e.description=a),rows:"1","auto-grow":"auto-grow",label:"\u8AAA\u660E",rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"2"}),m(),l(i,{cols:"2"}),l(i,{cols:"8"},{default:o(()=>[l(M,{modelValue:e.category,"onUpdate:modelValue":s[5]||(s[5]=a=>e.category=a),label:"\u5206\u985E",items:C,rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),l(i,{cols:"12"},{default:o(()=>[l(r,{modelValue:e.image,"onUpdate:modelValue":s[6]||(s[6]=a=>e.image=a),class:"mx-auto",removable:"removable","max-file-size":1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l($,null,{default:o(()=>[l(j),l(c,{disabled:e.loading,color:"red",onClick:s[7]||(s[7]=a=>e.dialog=!1)},{default:o(()=>[m("\u53D6\u6D88")]),_:1},8,["disabled"]),l(c,{disabled:e.loading,color:"green",type:"submit"},{default:o(()=>[m("\u9001\u51FA")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"])])}}};export{te as default};
