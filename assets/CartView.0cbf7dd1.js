import{u as x,ag as N,a as S,s as C,ar as T,S as $,as as A,o as d,c as F,w as s,V as R,b as t,d as e,f as o,al as f,am as z,X as D,b0 as E,j as c,aj as u,a3 as b,i as _,e as I,b1 as L,ah as O}from"./index.c2e833b5.js";import{V as P}from"./VTable.8b367126.js";import{V as k}from"./VTextField.81c8955c.js";const U={id:"cart",class:"m-a"},X=t("h1",{class:"text-center h1-title m-a"},"\u8CFC\u7269\u8ECA",-1),G=t("thead",null,[t("tr",null,[t("th",null,"\u5716\u7247"),t("th",null,"\u540D\u7A31"),t("th",null,"\u55AE\u50F9"),t("th",null,"\u6578\u91CF"),t("th",null,"\u5C0F\u8A08"),t("th",null,"\u64CD\u4F5C")])],-1),H={class:"justify-sm-end"},J={key:0},K=t("td",{class:"text-center big",colspan:"6"},"\u6C92\u6709\u5546\u54C1",-1),M=[K],Q=t("h1",{class:"bg-white"},[t("br")],-1),W={class:"text-center bg-white"},Y=t("h1",{class:"text-center tfoot"},[t("br")],-1),Z={data:()=>({rules:[i=>!!i||"\u5FC5\u586B",i=>i&&i.length>=3||"\u5FC5\u9808\u4E09\u500B\u5B57"]})},at=Object.assign(Z,{__name:"CartView",setup(i){const y=x(),g=N(),{editCart:V,checkout:w}=g,l=S([]),h=async(a,r)=>{await V({_id:l[a].p_id._id,quantity:r}),l[a].quantity+=r,l[a].quantity<=0&&l.splice(a,1)},B=async()=>{await w(),y.push("/orders")},q=C(()=>l.reduce((a,r)=>a+r.p_id.price*r.quantity,0)),v=C(()=>l.length>0&&!l.some(a=>!a.p_id.sell));return(async()=>{try{const{data:a}=await T.get("/users/cart");l.push(...a.result)}catch{$.fire({icon:"error",title:"\u5931\u6557",text:"\u53D6\u5F97\u8CFC\u7269\u8ECA\u5931\u6557"})}})(),(a,r)=>{const j=A("row");return d(),F(R,{id:"app"},{default:s(()=>[t("div",U,[e(I,null,{default:s(()=>[e(o,{cols:"12"},{default:s(()=>[X]),_:1}),e(o,{cols:"12"},{default:s(()=>[e(P,null,{default:s(()=>[G,t("tbody",null,[(d(!0),f(D,null,z(l,(n,p)=>(d(),f("tr",{key:n._id,class:L({"bg-red":!n.p_id.sell})},[t("td",null,[e(O,{"aspect-ratio":1,width:150,src:n.p_id.image},null,8,["src"])]),t("td",null,u(n.p_id.name),1),t("td",null,u(n.p_id.price),1),t("td",H,[e(j,null,{default:s(()=>[e(o,{cols:"12"},{default:s(()=>[e(_,{color:"primary",onClick:m=>h(p,-1)},{default:s(()=>[c("-")]),_:2},1032,["onClick"]),c(" \xA0"+u(n.quantity)+" \xA0",1),e(_,{color:"primary",onClick:m=>h(p,1)},{default:s(()=>[c("+")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),t("td",null,u(n.quantity*n.p_id.price),1),t("td",null,[e(_,{color:"red",onClick:m=>h(p,n.quantity*-1)},{default:s(()=>[c("\u522A\u9664")]),_:2},1032,["onClick"])])],2))),128)),l.length===0?(d(),f("tr",J,M)):E("",!0)])]),_:1}),Q,t("h1",W,[e(o,{cols:"6",class:"m-a"},{default:s(()=>[e(k,{label:"\u5BC4\u9001\u5730\u5740",rules:a.rules,"hide-details":"auto"},{default:s(()=>[c("\u53F0\u7063")]),_:1},8,["rules"])]),_:1}),e(o,{cols:"6",class:"m-a"},{default:s(()=>[e(k,{label:"\u96FB\u8A71",rules:a.rules,"hide-details":"auto"},null,8,["rules"])]),_:1}),e(o,{class:"text-center",cols:"12"},{default:s(()=>[t("p",null,"\u7E3D\u91D1\u984D "+u(b(q)),1),e(_,{color:"green",disabled:!b(v),onClick:B},{default:s(()=>[c("\u7D50\u5E33")]),_:1},8,["disabled"])]),_:1})])]),_:1}),e(o,{cols:"12"},{default:s(()=>[Y]),_:1})]),_:1})])]),_:1})}}});export{at as default};
