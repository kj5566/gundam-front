import{r as S,a as v,ar as c,S as m,as as q,o as f,al as g,d as a,w as o,j as w,b as s,e as r,h as p,i as V,W as T,am as h,f as B,ag as D,at as F,aj as _,ai as N,au as $,bs as j,ah as A}from"./index.b84716e4.js";import{V as z,a as E}from"./VTextarea.82893996.js";import{V as I}from"./VTable.19ad7d7b.js";import{V as L}from"./VForm.fa53c73b.js";import{V as b}from"./VTextField.7c6d58b4.js";import{V as M}from"./VSelect.5139a604.js";import"./VOverlay.cbc7e026.js";import"./VList.77ebb99b.js";import"./VDivider.c9724616.js";const R={id:"admin-biddings"},W=s("h1",{class:"text-center"},"\u7AF6\u6A19\u7BA1\u7406",-1),G=s("thead",null,[s("tr",null,[s("th",null,"\u5716\u7247"),s("th",null,"\u540D\u7A31"),s("th",null,"\u6642\u9593"),s("th",null,"\u7BA1\u7406")])],-1),H={class:"text-center"},te={__name:"BiddingView",setup(J){const x=S(null),C=["\u6A21\u578B","\u904A\u6232\u738B\u5361","\u516C\u4ED4","\u666F\u54C1","\u5176\u4ED6"],u={required(t){return!!t||"\u6B04\u4F4D\u5FC5\u586B"},price(t){return t>=0||"\u50F9\u683C\u932F\u8AA4"},time(t){return t>=0||"\u6642\u9593\u932F\u8AA4"}},d=v([]),e=v({_id:"",name:"",price:0,description:"",image:void 0,time:0,sell:!1,category:"",valid:!1,loading:!1,dialog:!1,idx:-1}),y=t=>{t===-1?(e._id="",e.name="",e.price=0,e.time=0,e.description="",e.image=void 0,e.sell=!1,e.category="",e.valid=!1,e.loading=!1,e.idx=-1):(e._id=d[t]._id,e.name=d[t].name,e.price=d[t].price,e.time=d[t].time,e.description=d[t].description,e.image=void 0,e.sell=d[t].sell,e.category=d[t].category,e.valid=!1,e.loading=!1,e.idx=t),e.dialog=!0},k=async()=>{var i,n;if(!e.valid)return;e.loading=!0;const t=new FormData;t.append("name",e.name),t.append("price",e.price),t.append("description",e.description),t.append("image",e.image),t.append("sell",e.sell),t.append("category",e.category);try{if(e._id.length===0){const{data:l}=await c.post("/biddings",t);d.push(l.result),m.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:l}=await c.patch("/biddings/"+e._id,t);d[e.idx]=l.result,m.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(l){m.fire({icon:"error",title:"\u5931\u6557",text:((n=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:n.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1};return(async()=>{var t,i;try{const{data:n}=await c.get("/biddings/all");d.push(...n.result)}catch(n){m.fire({icon:"error",title:"\u5931\u6557",text:((i=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:i.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(t,i)=>{const n=q("v-image-input");return f(),g("div",R,[W,a(w,null,{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[a(p,{color:"success",onClick:i[0]||(i[0]=l=>y(-1))},{default:o(()=>[V("\u65B0\u589E\u7AF6\u6A19\u5546\u54C1")]),_:1})]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(I,null,{default:o(()=>[G,s("tbody",null,[(f(!0),g(T,null,h(d,(l,U)=>(f(),g("tr",{key:l._id},[s("td",null,[a(A,{src:l.image,"aspect-ratio":1,width:200},null,8,["src"])]),s("td",null,_(l.name),1),s("td",null,_(l.time),1),s("td",null,[a(p,{color:"primary",icon:"mdi-pencil",variant:"text",onClick:K=>y(U)},null,8,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1}),a(z,{modelValue:e.dialog,"onUpdate:modelValue":i[9]||(i[9]=l=>e.dialog=l),persistent:"persistent"},{default:o(()=>[a(L,{modelValue:e.valid,"onUpdate:modelValue":i[8]||(i[8]=l=>e.valid=l),onSubmit:B(k,["prevent"])},{default:o(()=>[a(D,null,{default:o(()=>[a(F,null,{default:o(()=>[s("h1",H,_(e._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u7AF6\u6A19\u5546\u54C1"),1)]),_:1}),a(N,null,{default:o(()=>[a(w,null,{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[a(b,{ref_key:"input",ref:x,modelValue:e.name,"onUpdate:modelValue":i[1]||(i[1]=l=>e.name=l),type:"text",label:"\u540D\u7A31",rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(b,{modelValue:e.price,"onUpdate:modelValue":i[2]||(i[2]=l=>e.price=l),type:"number",label:"\u8D77\u6A19\u50F9\u683C",rules:[u.required,u.price]},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(b,{modelValue:e.time,"onUpdate:modelValue":i[3]||(i[3]=l=>e.time=l),type:"number",label:"\u6642\u9593",rules:[u.required,u.time]},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(E,{modelValue:e.description,"onUpdate:modelValue":i[4]||(i[4]=l=>e.description=l),rows:"1","auto-grow":"auto-grow",label:"\u8AAA\u660E",rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(M,{modelValue:e.category,"onUpdate:modelValue":i[5]||(i[5]=l=>e.category=l),items:C,rules:[u.required]},null,8,["modelValue","rules"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(n,{modelValue:e.image,"onUpdate:modelValue":i[6]||(i[6]=l=>e.image=l),class:"mx-auto",removable:"removable","max-file-size":1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a($,null,{default:o(()=>[a(j),a(p,{disabled:e.loading,color:"red",onClick:i[7]||(i[7]=l=>e.dialog=!1)},{default:o(()=>[V("\u53D6\u6D88")]),_:1},8,["disabled"]),a(p,{disabled:e.loading,color:"green",type:"submit"},{default:o(()=>[V("\u9001\u51FA")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1},8,["modelValue"])])}}};export{te as default};
